
第七章 设备管理
    7．1  I/O系统组成
    7．2  I/O控制方式
    7．3  缓冲管理
    7．4  设备分配
    7．5  设备处理
返回<<
　7．1  I/O系统组成

（学生自行阅读）

7．1．1 I/O系统的结构

一、微型机I/O系统——总线I/O系统结构

二、  主机I/O系统——通道I/O系统结构

7．1．2 I/O设备

一、I/O设备的类型

1．按传输速率分

低速设备——几个～数百个 B/S

中速设备——数K～数十KB/S

高速设备——数百K～数MB/S

2．按信息交换的单位分类

块设备——用于存储信息，信息的存取以数据块为单位。特征：传输速率较高；可寻址；采用DMA方式

字符设备——用于数据的输入和输出，基本单位是字符。特征：传输速率较低；不可寻址；采用中断驱动方式。

3．按设备的共享属性分类

独占设备——一段时间内只允许一个用户（进程）访问的设备。

共享设备——一段时间内允许多个进程同时访问的设备。

虚拟设备——通过虚拟技术将一台独占设备变换为若干台逻辑设备。

二、设备与控制器之间的接口

数据信号；控制信号；状态信号

7．1．3 设备控制器

一、设备控制器的功能

1．接收和识别命令

2．数据交换

3．设备状态的了解和报告

二、设备控制器的组成

1．设备控制器与处理机的接口

2．设备控制器与设备的接口

3．I/O逻辑

7．1．4 I/O通道

一、通道设备的引入

二、通道类型

1．字节多路通道（Byte Multiplexor Channal）

2．数组选择通道（Block Selector Channal）

3．数组多路通道

三、“瓶颈”问题

7．2  I/O控制方式

（学生自行阅读，着重介绍通道方式）

一、程序I/O方式

二、中断驱动I/O控制方式

三、  直接存储器访问DMA控制方式

1．  DMA控制方式的引入

2．  DMA控制器的组成

命令/状态寄存器CR、内存地址寄存器MAR、数据寄存器DR、数据计数器DC

3．  DMA工作过程

四、I/O通道控制方式

1．  I/O通道控制方式的引入

2．  通道程序

7．3  缓冲管理

1．缓冲的引入

缓和CPU和I/O设备速度不匹配的矛盾；

减少对CPU的中断频率，放宽对中断响应时间的限制；

提高CPU和I/O设备之间的并行性。

2．单缓冲

3．双缓冲

4．  循环缓冲

⑴组成——多个缓冲区、多个指针

⑵缓冲区的使用——Getbuf过程、Releasebuf过程

⑶进程同步——Nexti指针追上Nextg指针、Nextg指针追上Nexti指针

5．  缓冲池

   ⑴缓冲池的组成——空缓冲队列emq、输入队列inq、输出队列outq

   ⑵Getbuf过程和Putbuf过程

   ⑶缓冲区的工作方式——收容输入工作方式、提取输出工作方式、收容输出工作方式、提取输出工作方式

7．4设备分配

1．设备分配中的数据结构

逻辑设备表（LUT）→系统设备表（SDT）→设备控制表（DCT）→控制器控制表（COCT）→通道控制表（CHCT）

2．设备分配时应考虑的若干因素

⑴考虑设备的固有属性

  独享设备、共享设备、虚拟设备

⑵设备分配算法：

  先来先服务、优先级高者优先

⑶设备分配的安全性

  安全分配方式

  不安全分配方式

3．设备独立性

⑴设备独立性

  设备独立性概念：应用程序独立于具体使用的物理设备

  设备独立性优点：设备分配时的灵活性；易于实现I/O重定向

 ⑵设备独立性软件

  完成功能：执行所有设备的公有操作；向用户层（或文件层）软件提供统一的接口

 ⑶逻辑设备名到物理设备名映射的实现

  逻辑设备表（LUT）；LUT的设置问题——整个系统设置一张LUT、每个用户设置一张LUT

4．独占设备的分配程序

   ⑴基本的设备分配程序

     分配设备

     分配控制器

     分配通道

   ⑵设备分配程序的改进

     增加设备的独立性

     考虑多通路情况

5．SPOOLING技术

⑴什么是SPOOLING——（Simultaneous Peripheral Operations On-Line）假脱机操作

⑵SPOOLING系统的组成

  输入井和输出井、输入缓冲区和输出缓冲区、输入进程和输出进程

⑶共享打印机

⑷SPOOLING系统的特点

  提高了I/O速度、将独占设备改造为共享设备、实现了虚拟设备功能

7．5  设备处理

1．设备驱动程序的功能和特点

  ⑴设备驱动程序的功能

  ⑵设备处理方式

  ⑶设备驱动程序的特点

2．设备驱动程序的处理过程

将抽象要求转换为具体要求；

检查I/O请求的合法性；

读出和检查设备的状态；

传送必要的参数；

方式的设置；

启动I/O设备。

3．中断处理程序的处理过程

唤醒被阻塞的驱动程序进程；

保护被中断进程的CPU环境；

分析中断的原因、转入相应的设备中断处理程序；

进行中断处理；

恢复被中断进程的现场。

返回<<
